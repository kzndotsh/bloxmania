<header-drawer>
  <header
    class="header header--transparent"
    id="header"
    role="banner"
  >
    <div class="flex items-center justify-between px-4 md:px-8 py-6 max-w-7xl mx-auto">
      <!-- Left: Mobile Menu Button / Desktop Logo -->
      <div class="flex items-center flex-shrink-0">
        <!-- Mobile Menu Button (Desktop Hidden) -->
        <button
          class="block md:hidden header__icon-button mobile-menu-toggle"
          id="mobile-menu-toggle"
          aria-label="Open mobile menu"
          aria-expanded="false"
          aria-controls="mobile-menu"
          type="button"
        >
          <svg class="header__icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
          </svg>
        </button>

        <!-- Desktop Logo -->
        <div class="flex-shrink-0 hidden md:block">
          {% if section.settings.logo != blank %}
            <a href="{{ routes.root_url }}">
              <img
                src="{{ section.settings.logo | image_url: width: 233 }}"
                alt="{{ shop.name }}"
                class="h-14 lg:h-16 w-auto transition-transform duration-300 cursor-pointer hover:scale-105"
                width="233"
                height="70"
              >
            </a>
          {% else %}
            <a href="{{ routes.root_url }}">
              {% render 'responsive-image',
                image: 'image-BM.png',
                alt: 'BloxMania',
                class: 'h-14 lg:h-16 w-auto transition-transform duration-300 cursor-pointer hover:scale-105',
                width: 233,
                height: 70,
                loading: 'eager',
                sizes: '233px'
              %}
            </a>
          {% endif %}
        </div>
      </div>

      <!-- Center: Mobile Logo / Desktop Navigation -->
      <div class="flex justify-center flex-1 min-w-0">
        <!-- Mobile Logo -->
        <div class="block md:hidden">
          {% if section.settings.logo != blank %}
            <a href="{{ routes.root_url }}">
              <img
                src="{{ section.settings.logo | image_url: width: 150 }}"
                alt="{{ shop.name }}"
                class="h-12 w-auto cursor-pointer"
                width="150"
                height="48"
              >
            </a>
          {% else %}
            <a href="{{ routes.root_url }}">
              <img
                src="{{ 'image-BM.png' | asset_url }}"
                alt="BloxMania"
                class="h-12 w-auto cursor-pointer"
                width="150"
                height="48"
              >
            </a>
          {% endif %}
        </div>

        <!-- Desktop Navigation -->
        <nav
          class="hidden md:flex items-center justify-center gap-10 lg:gap-12 xl:gap-14 min-w-0"
          role="navigation"
          aria-label="Main navigation"
        >
          <a
            href="{{ routes.all_products_collection_url }}"
            class="nav-link text-gray-300 no-underline font-semibold text-lg lg:text-xl transition-all duration-300 relative flex items-center gap-2 whitespace-nowrap py-2 hover:text-primary after:content-[''] after:absolute after:bottom-0 after:left-0 after:w-0 after:h-0.5 after:bg-primary after:transition-all after:duration-300 hover:after:w-full"
          >
            <svg class="w-5 h-5 lg:w-6 lg:h-6 transition-colors duration-300" fill="currentColor" viewBox="0 0 24 24">
              <path d="M15.75 10.5V6a3.75 3.75 0 10-7.5 0v4.5m11.356-1.993l1.263 12c.07.665-.45 1.243-1.119 1.243H4.25a1.125 1.125 0 01-1.12-1.243l1.264-12A1.125 1.125 0 015.513 7.5h12.974c.576 0 1.059.435 1.119.997zM8.625 10.5a.375.375 0 11-.75 0 .375.375 0 01.75 0zm7.5 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z"/>
            </svg>
            Shop Now
          </a>

          <a
            href="{{ pages.guarantee.url | default: '/pages/guarantee' }}"
            class="nav-link text-gray-300 no-underline font-semibold text-lg lg:text-xl transition-all duration-300 relative flex items-center gap-2 whitespace-nowrap py-2 hover:text-primary after:content-[''] after:absolute after:bottom-0 after:left-0 after:w-0 after:h-0.5 after:bg-primary after:transition-all after:duration-300 hover:after:w-full"
          >
            <div class="relative">
              <svg class="w-5 h-5 lg:w-6 lg:h-6 transition-colors duration-300" fill="currentColor" viewBox="0 0 24 24">
                <path fill-rule="evenodd" d="M12.516 2.17a.75.75 0 00-1.032 0 11.209 11.209 0 01-7.877 3.08.75.75 0 00-.722.515A12.74 12.74 0 002.25 9.75c0 5.814 3.876 10.713 9.022 12.109a.75.75 0 00.956 0C17.424 20.463 21.3 15.564 21.3 9.75a12.74 12.74 0 00-.635-4.235.75.75 0 00-.722-.515 11.209 11.209 0 01-7.877-3.08zM15.75 9.75a3 3 0 11-6 0 3 3 0 016 0z" clip-rule="evenodd"/>
              </svg>
              <svg
                class="absolute inset-0 w-2.5 h-2.5 lg:w-4 lg:h-4 m-auto transition-colors duration-300"
                fill="currentColor"
                viewBox="0 0 24 24"
              >
                <path fill-rule="evenodd" d="M19.916 4.626a.75.75 0 01.208 1.04l-9 13.5a.75.75 0 01-1.154.114l-6-6a.75.75 0 011.06-1.06l5.353 5.353 8.493-12.739a.75.75 0 011.04-.208z" clip-rule="evenodd"/>
              </svg>
            </div>
            Our Guarantee
          </a>

          {% if section.settings.discord_url != blank %}
            <a
              href="{{ section.settings.discord_url }}"
              class="nav-link text-gray-300 no-underline font-semibold text-lg lg:text-xl transition-all duration-300 relative flex items-center gap-2 whitespace-nowrap py-2 hover:text-primary after:content-[''] after:absolute after:bottom-0 after:left-0 after:w-0 after:h-0.5 after:bg-primary after:transition-all after:duration-300 hover:after:w-full"
              target="_blank"
              rel="noopener"
            >
              <svg class="w-5 h-5 lg:w-6 lg:h-6 transition-colors duration-300" fill="currentColor" viewBox="0 0 24 24">
                <path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515a.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0a12.64 12.64 0 0 0-.617-1.25a.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057a19.9 19.9 0 0 0 5.993 3.03a.078.078 0 0 0 .084-.028a14.09 14.09 0 0 0 1.226-1.994a.076.076 0 0 0-.041-.106a13.107 13.107 0 0 1-1.872-.892a.077.077 0 0 1-.008-.128a10.2 10.2 0 0 0 .372-.292a.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127a12.299 12.299 0 0 1-1.873.892a.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028a19.839 19.839 0 0 0 6.002-3.03a.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.956-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.955-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.946 2.418-2.157 2.418z"/>
              </svg>
              Daily Giveaways
            </a>
          {% else %}
            <a
              href="https://discord.gg/bloxmania"
              class="nav-link text-gray-300 no-underline font-semibold text-lg lg:text-xl transition-all duration-300 relative flex items-center gap-2 whitespace-nowrap py-2 hover:text-primary after:content-[''] after:absolute after:bottom-0 after:left-0 after:w-0 after:h-0.5 after:bg-primary after:transition-all after:duration-300 hover:after:w-full"
              target="_blank"
              rel="noopener"
            >
              <svg class="w-5 h-5 lg:w-6 lg:h-6 transition-colors duration-300" fill="currentColor" viewBox="0 0 24 24">
                <path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515a.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0a12.64 12.64 0 0 0-.617-1.25a.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057a19.9 19.9 0 0 0 5.993 3.03a.078.078 0 0 0 .084-.028a14.09 14.09 0 0 0 1.226-1.994a.076.076 0 0 0-.041-.106a13.107 13.107 0 0 1-1.872-.892a.077.077 0 0 1-.008-.128a10.2 10.2 0 0 0 .372-.292a.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127a12.299 12.299 0 0 1-1.873.892a.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028a19.839 19.839 0 0 0 6.002-3.03a.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.956-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.955-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.946 2.418-2.157 2.418z"/>
              </svg>
              Daily Giveaways
            </a>
          {% endif %}

          <a
            href="{{ pages['purchasing-guide'].url | default: '/pages/purchasing-guide' }}"
            class="nav-link text-gray-300 no-underline font-semibold text-lg lg:text-xl transition-all duration-300 relative flex items-center gap-2 whitespace-nowrap py-2 hover:text-primary after:content-[''] after:absolute after:bottom-0 after:left-0 after:w-0 after:h-0.5 after:bg-primary after:transition-all after:duration-300 hover:after:w-full"
          >
            <svg class="w-5 h-5 lg:w-6 lg:h-6 transition-colors duration-300" fill="currentColor" viewBox="0 0 24 24">
              <path fill-rule="evenodd" d="M5.625 1.5c-1.036 0-1.875.84-1.875 1.875v17.25c0 1.035.84 1.875 1.875 1.875h12.75c1.035 0 1.875-.84 1.875-1.875V12.75A3.75 3.75 0 0016.5 9h-1.875a1.875 1.875 0 01-1.875-1.875V5.25A3.75 3.75 0 009 1.5H5.625zM7.5 15a.75.75 0 01.75-.75h7.5a.75.75 0 010 1.5h-7.5A.75.75 0 017.5 15zm.75 2.25a.75.75 0 000 1.5H12a.75.75 0 000-1.5H8.25z" clip-rule="evenodd"/>
              <path d="M12.971 1.816A5.23 5.23 0 0114.25 5.25v1.875c0 .207.168.375.375.375H16.5a5.23 5.23 0 013.434 1.279 9.768 9.768 0 00-6.963-6.963z"/>
            </svg>
            Purchasing Guide
          </a>
        </nav>
      </div>

      <!-- Right: User Actions -->
      <div class="flex items-center justify-end gap-3 flex-shrink-0">
        <!-- Search Button -->
        <button
          class="header__icon-button search-toggle"
          aria-label="Search"
          type="button"
          data-search-toggle
        >
          <svg class="header__icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
          </svg>
        </button>

        <!-- Cart Button -->
        <a
          href="{{ routes.cart_url }}"
          class="header__icon-button header__cart-button"
          aria-label="Shopping cart"
        >
          <svg class="header__icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-2.5 5M7 13l2.5 5m6-5v6a2 2 0 01-2 2H9a2 2 0 01-2-2v-6m8 0V9a2 2 0 00-2-2H9a2 2 0 00-2 2v4.01"/>
          </svg>
          {% if cart.item_count > 0 %}
            <span class="header__cart-badge">
              {{- cart.item_count -}}
            </span>
          {% endif %}
        </a>

        <!-- Account Button -->
        <a
          href="{% if customer %}{{ routes.account_url }}{% else %}{{ routes.account_login_url }}{% endif %}"
          class="header__icon-button"
          aria-label="{% if customer %}User account{% else %}Sign in{% endif %}"
        >
          <svg class="header__icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
          </svg>
        </a>
      </div>
    </div>

    <!-- Mobile Menu -->
    <div
      class="mobile-menu fixed top-0 left-0 w-full h-screen z-60 hidden flex-col overflow-hidden transition-all duration-300 ease-in-out"
      id="mobile-menu"
      role="dialog"
      aria-modal="true"
      aria-labelledby="mobile-menu-title"
      aria-hidden="true"
    >
      <div class="mobile-menu__header flex items-center justify-between p-8 flex-shrink-0">
        {% if section.settings.logo != blank %}
          <img
            src="{{ section.settings.logo | image_url: width: 150 }}"
            alt="{{ shop.name }}"
            class="h-14 w-auto cursor-pointer"
            width="150"
            height="48"
          >
        {% else %}
          <img
            src="{{ 'image-BM.png' | asset_url }}"
            alt="BloxMania"
            class="h-14 w-auto cursor-pointer"
            width="150"
            height="48"
          >
        {% endif %}
        <button
          class="header__icon-button"
          id="mobile-menu-close"
          aria-label="Close mobile menu"
        >
          <svg class="header__icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>

      <h2 id="mobile-menu-title" class="sr-only">Mobile Navigation Menu</h2>
      <nav class="flex-1 overflow-y-auto flex flex-col" role="navigation" aria-label="Mobile navigation">
        <a
          href="{{ routes.all_products_collection_url }}"
          class="text-slate-100 no-underline text-xl md:text-2xl font-medium py-6 px-8 border-b border-white/10 flex items-center gap-4 transition-all duration-200 hover:text-primary hover:bg-primary/6"
        >
          <svg class="w-6 h-6 flex-shrink-0" fill="currentColor" viewBox="0 0 24 24">
            <path d="M15.75 10.5V6a3.75 3.75 0 10-7.5 0v4.5m11.356-1.993l1.263 12c.07.665-.45 1.243-1.119 1.243H4.25a1.125 1.125 0 01-1.12-1.243l1.264-12A1.125 1.125 0 015.513 7.5h12.974c.576 0 1.059.435 1.119.997zM8.625 10.5a.375.375 0 11-.75 0 .375.375 0 01.75 0zm7.5 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z"/>
          </svg>
          Shop Now
        </a>

        <a
          href="{{ pages.guarantee.url | default: '/pages/guarantee' }}"
          class="text-slate-100 no-underline text-xl md:text-2xl font-medium py-6 px-8 border-b border-white/10 flex items-center gap-4 transition-all duration-200 hover:text-primary hover:bg-primary/6"
        >
          <div class="relative flex-shrink-0">
            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
              <path fill-rule="evenodd" d="M12.516 2.17a.75.75 0 00-1.032 0 11.209 11.209 0 01-7.877 3.08.75.75 0 00-.722.515A12.74 12.74 0 002.25 9.75c0 5.814 3.876 10.713 9.022 12.109a.75.75 0 00.956 0C17.424 20.463 21.3 15.564 21.3 9.75a12.74 12.74 0 00-.635-4.235.75.75 0 00-.722-.515 11.209 11.209 0 01-7.877-3.08zM15.75 9.75a3 3 0 11-6 0 3 3 0 016 0z" clip-rule="evenodd"/>
            </svg>
            <svg class="absolute inset-0 w-4 h-4 m-auto" fill="currentColor" viewBox="0 0 24 24">
              <path fill-rule="evenodd" d="M19.916 4.626a.75.75 0 01.208 1.04l-9 13.5a.75.75 0 01-1.154.114l-6-6a.75.75 0 011.06-1.06l5.353 5.353 8.493-12.739a.75.75 0 011.04-.208z" clip-rule="evenodd"/>
            </svg>
          </div>
          Our Guarantee
        </a>

        {% if section.settings.discord_url != blank %}
          <a
            href="{{ section.settings.discord_url }}"
            class="text-slate-100 no-underline text-xl md:text-2xl font-medium py-6 px-8 border-b border-white/10 flex items-center gap-4 transition-all duration-200 hover:text-primary hover:bg-primary/6"
            target="_blank"
            rel="noopener"
          >
            <svg class="w-6 h-6 flex-shrink-0" fill="currentColor" viewBox="0 0 24 24">
              <path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515a.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0a12.64 12.64 0 0 0-.617-1.25a.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057a19.9 19.9 0 0 0 5.993 3.03a.078.078 0 0 0 .084-.028a14.09 14.09 0 0 0 1.226-1.994a.076.076 0 0 0-.041-.106a13.107 13.107 0 0 1-1.872-.892a.077.077 0 0 1-.008-.128a10.2 10.2 0 0 0 .372-.292a.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127a12.299 12.299 0 0 1-1.873.892a.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028a19.839 19.839 0 0 0 6.002-3.03a.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.956-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.955-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.946 2.418-2.157 2.418z"/>
            </svg>
            Daily Giveaways
          </a>
        {% else %}
          <a
            href="https://discord.gg/bloxmania"
            class="text-slate-100 no-underline text-xl md:text-2xl font-medium py-6 px-8 border-b border-white/10 flex items-center gap-4 transition-all duration-200 hover:text-primary hover:bg-primary/6"
            target="_blank"
            rel="noopener"
          >
            <svg class="w-6 h-6 flex-shrink-0" fill="currentColor" viewBox="0 0 24 24">
              <path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515a.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0a12.64 12.64 0 0 0-.617-1.25a.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057a19.9 19.9 0 0 0 5.993 3.03a.078.078 0 0 0 .084-.028a14.09 14.09 0 0 0 1.226-1.994a.076.076 0 0 0-.041-.106a13.107 13.107 0 0 1-1.872-.892a.077.077 0 0 1-.008-.128a10.2 10.2 0 0 0 .372-.292a.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127a12.299 12.299 0 0 1-1.873.892a.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028a19.839 19.839 0 0 0 6.002-3.30a.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.956-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.955-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.946 2.418-2.157 2.418z"/>
            </svg>
            Daily Giveaways
          </a>
        {% endif %}

        <a
          href="{{ pages['purchasing-guide'].url | default: '/pages/purchasing-guide' }}"
          class="text-slate-100 no-underline text-xl md:text-2xl font-medium py-6 px-8 border-b border-white/10 flex items-center gap-4 transition-all duration-200 hover:text-primary hover:bg-primary/6"
        >
          <svg class="w-6 h-6 flex-shrink-0" fill="currentColor" viewBox="0 0 24 24">
            <path fill-rule="evenodd" d="M5.625 1.5c-1.036 0-1.875.84-1.875 1.875v17.25c0 1.035.84 1.875 1.875 1.875h12.75c1.035 0 1.875-.84 1.875-1.875V12.75A3.75 3.75 0 0016.5 9h-1.875a1.875 1.875 0 01-1.875-1.875V5.25A3.75 3.75 0 009 1.5H5.625zM7.5 15a.75.75 0 01.75-.75h7.5a.75.75 0 010 1.5h-7.5A.75.75 0 017.5 15zm.75 2.25a.75.75 0 000 1.5H12a.75.75 0 000-1.5H8.25z" clip-rule="evenodd"/>
            <path d="M12.971 1.816A5.23 5.23 0 0114.25 5.25v1.875c0 .207.168.375.375.375H16.5a5.23 5.23 0 013.434 1.279 9.768 9.768 0 00-6.963-6.963z"/>
          </svg>
          Purchasing Guide
        </a>
      </nav>
    </div>
  </header>

  <!-- Search Modal -->
  <div id="search-modal" class="search-modal hidden fixed inset-0 z-50 overflow-hidden">
    <div class="search-modal__overlay absolute inset-0"></div>
    <div class="search-modal__content relative z-10 flex items-start justify-center min-h-screen p-4">
      <div class="search-modal__container w-full max-w-2xl rounded-2xl shadow-2xl mt-20">
        <!-- Search Modal Header -->
        <div class="search-modal__header flex items-center justify-between p-6 border-b border-white/10">
          <h2 class="text-xl font-semibold text-white">Search</h2>
          <button
            class="search-modal__close text-white hover:text-primary transition-colors duration-200 p-2 rounded-lg hover:bg-white/10"
            aria-label="Close search"
            data-search-close
          >
            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
              <path fill-rule="evenodd" d="M5.47 5.47a.75.75 0 011.06 0L12 10.94l5.47-5.47a.75.75 0 111.06 1.06L13.06 12l5.47 5.47a.75.75 0 11-1.06 1.06L12 13.06l-5.47 5.47a.75.75 0 01-1.06-1.06L10.94 12 5.47 6.53a.75.75 0 010-1.06z" clip-rule="evenodd"/>
            </svg>
          </button>
        </div>

        <!-- Search Form -->
        <div class="search-modal__body p-6">
          <form class="search-modal__form" action="{{ routes.search_url }}" method="get" role="search">
            <div class="search-modal__input-wrapper relative">
              <input
                type="search"
                name="q"
                class="search-modal__input w-full pr-12 py-3 pl-12 bg-gray-800/60 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary/50 transition-all duration-200"
                placeholder="{{ 'general.search.placeholder' | t: default: 'Search for products, collections, or pages...' }}"
                aria-label="{{ 'general.search.search' | t: default: 'Search' }}"
                autocomplete="off"
                spellcheck="false"
              >
              <div class="search-modal__icon absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                  <path fill-rule="evenodd" d="M10.5 3.75a6.75 6.75 0 100 13.5 6.75 6.75 0 000-13.5zM2.25 10.5a8.25 8.25 0 1114.59 5.28l4.69 4.69a.75.75 0 11-1.06 1.06l-4.69-4.69A8.25 8.25 0 012.25 10.5z" clip-rule="evenodd"/>
                </svg>
              </div>
              <button
                type="submit"
                class="search-modal__submit absolute right-2 top-1/2 transform -translate-y-1/2 p-2 bg-primary text-black rounded-md hover:bg-yellow-400 transition-colors duration-200"
                aria-label="Submit search"
              >
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                  <path fill-rule="evenodd" d="M10.5 3.75a6.75 6.75 0 100 13.5 6.75 6.75 0 000-13.5zM2.25 10.5a8.25 8.25 0 1114.59 5.28l4.69 4.69a.75.75 0 11-1.06 1.06l-4.69-4.69A8.25 8.25 0 012.25 10.5z" clip-rule="evenodd"/>
                </svg>
              </button>
            </div>
          </form>

          <!-- Search Results -->
          <div class="search-modal__results mt-6 max-h-96 overflow-y-auto">
            <div class="search-modal__loading hidden text-center py-8">
              <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
              <p class="text-gray-400 mt-2">Searching...</p>
            </div>
            <div class="search-modal__content-results"></div>
            <div class="search-modal__no-results hidden text-center py-8">
              <p class="text-gray-400">No results found</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const header = document.getElementById('header');
      const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
      const mobileMenu = document.getElementById('mobile-menu');
      const mobileMenuClose = document.getElementById('mobile-menu-close');

      // Enhanced header scroll effect with gradual transition
      function handleScroll() {
        const scrollY = window.scrollY;
        const maxScroll = 150; // Full transition at 150px

        // Calculate scroll progress (0 to 1)
        const scrollProgress = Math.min(scrollY / maxScroll, 1);

        // Apply CSS custom properties for smooth interpolation
        header.style.setProperty('--scroll-progress', scrollProgress);

        // Add base class for styling
        header.classList.add('header--dynamic');

        // Remove old classes to prevent conflicts
        header.classList.remove('header--transparent', 'header--scrolled');
      }

      // Initialize header state
      handleScroll();
      window.addEventListener('scroll', handleScroll);

      // Mobile menu toggle
      if (mobileMenuToggle && mobileMenu && mobileMenuClose) {
        mobileMenuToggle.addEventListener('click', function () {
          const isExpanded = mobileMenuToggle.getAttribute('aria-expanded') === 'true';
          mobileMenuToggle.setAttribute('aria-expanded', !isExpanded);
          mobileMenu.classList.toggle('hidden');
          document.body.classList.toggle('overflow-hidden');
        });

        mobileMenuClose.addEventListener('click', function () {
          mobileMenuToggle.setAttribute('aria-expanded', 'false');
          mobileMenu.classList.add('hidden');
          document.body.classList.remove('overflow-hidden');
        });

        // Close mobile menu when clicking on a link
        const mobileMenuLinks = mobileMenu.querySelectorAll('a');
        mobileMenuLinks.forEach((link) => {
          link.addEventListener('click', function () {
            mobileMenuToggle.setAttribute('aria-expanded', 'false');
            mobileMenu.classList.add('hidden');
            document.body.classList.remove('overflow-hidden');
          });
        });
      }

      // Search Modal Functionality
      const searchToggle = document.querySelector('[data-search-toggle]');
      const searchModal = document.getElementById('search-modal');
      const searchClose = document.querySelector('[data-search-close]');
      const searchInput = document.querySelector('.search-modal__input');
      const searchForm = document.querySelector('.search-modal__form');
      const searchResults = document.querySelector('.search-modal__content-results');
      const searchLoading = document.querySelector('.search-modal__loading');
      const searchNoResults = document.querySelector('.search-modal__no-results');

      // Open search modal
      if (searchToggle && searchModal) {
        searchToggle.addEventListener('click', function () {
          searchModal.classList.remove('hidden');
          document.body.classList.add('overflow-hidden');
          searchInput.focus();
        });
      }

      // Close search modal
      if (searchClose && searchModal) {
        searchClose.addEventListener('click', function () {
          searchModal.classList.add('hidden');
          document.body.classList.remove('overflow-hidden');
          searchInput.value = '';
          clearSearchResults();
        });
      }

      // Close search modal on overlay click
      if (searchModal) {
        searchModal.addEventListener('click', function (e) {
          if (e.target === searchModal) {
            searchModal.classList.add('hidden');
            document.body.classList.remove('overflow-hidden');
            searchInput.value = '';
            clearSearchResults();
          }
        });
      }

      // Close search modal on Escape key
      document.addEventListener('keydown', function (e) {
        if (e.key === 'Escape' && searchModal && !searchModal.classList.contains('hidden')) {
          searchModal.classList.add('hidden');
          document.body.classList.remove('overflow-hidden');
          searchInput.value = '';
          clearSearchResults();
        }
      });

      // Predictive search functionality
      let searchTimeout;
      if (searchInput) {
        searchInput.addEventListener('input', function () {
          const query = this.value.trim();

          // Clear previous timeout
          clearTimeout(searchTimeout);

          if (query.length < 2) {
            clearSearchResults();
            return;
          }

          // Show loading state
          showSearchLoading();

          // Debounce search requests
          searchTimeout = setTimeout(() => {
            performPredictiveSearch(query);
          }, 300);
        });
      }

      // Handle form submission
      if (searchForm) {
        searchForm.addEventListener('submit', function (e) {
          const query = searchInput.value.trim();
          if (!query) {
            e.preventDefault();
            return;
          }
          // Let the form submit normally to the search page
        });
      }

      // Search functions
      function showSearchLoading() {
        if (searchLoading) searchLoading.classList.remove('hidden');
        if (searchResults) searchResults.classList.add('hidden');
        if (searchNoResults) searchNoResults.classList.add('hidden');
      }

      function hideSearchLoading() {
        if (searchLoading) searchLoading.classList.add('hidden');
      }

      function clearSearchResults() {
        if (searchResults) {
          searchResults.innerHTML = '';
          searchResults.classList.add('hidden');
        }
        if (searchLoading) searchLoading.classList.add('hidden');
        if (searchNoResults) searchNoResults.classList.add('hidden');
      }

      async function performPredictiveSearch(query) {
        try {
          const response = await fetch(
            `/search/suggest.json?q=${encodeURIComponent(query)}&resources[type]=product&resources[limit]=6`
          );

          if (!response.ok) {
            throw new Error('Search request failed');
          }

          const data = await response.json();
          console.log('Search API response:', data); // Debug log

          // Handle the suggest.json response structure
          let results = [];
          if (data.resources && data.resources.results) {
            // Check if results is an array or object
            if (Array.isArray(data.resources.results)) {
              results = data.resources.results;
            } else if (typeof data.resources.results === 'object') {
              // If results is an object, extract products from it
              const resultsObj = data.resources.results;
              Object.keys(resultsObj).forEach((key) => {
                if (Array.isArray(resultsObj[key])) {
                  results.push(...resultsObj[key]);
                }
              });
            }
          } else if (data.resources && data.resources.products && Array.isArray(data.resources.products)) {
            results = data.resources.products;
          } else if (data.results && Array.isArray(data.results)) {
            results = data.results;
          } else if (data.products && Array.isArray(data.products)) {
            results = data.products;
          }

          console.log('Extracted results:', results); // Log the final results

          hideSearchLoading();
          displaySearchResults(results, query);
        } catch (error) {
          console.error('Search error:', error);
          hideSearchLoading();
          showNoResults();
        }
      }

      function displaySearchResults(results, query) {
        if (!searchResults) return;

        // Debug: Log the results structure
        console.log('Displaying results:', results);

        // Ensure results is an array and has items
        if (!Array.isArray(results) || results.length === 0) {
          showNoResults();
          return;
        }

        let html = '<div class="space-y-4">';

        results.forEach((result, index) => {
          console.log(`Result ${index}:`, result);

          // Ensure result has required properties
          if (!result || !result.title) {
            console.log(`Skipping result ${index} - missing title`);
            return; // Skip invalid results
          }

          // Fix URL handling - ensure it's a string
          let productUrl = '';
          if (result.handle) {
            productUrl = `/products/${result.handle}`;
          } else if (typeof result.url === 'string') {
            productUrl = result.url;
          } else if (result.id) {
            productUrl = `/products/${result.id}`;
          } else {
            console.log(`Skipping result ${index} - no valid URL`);
            return;
          }

          const title = highlightQuery(result.title, query);

          // Fix price handling
          let priceDisplay = '';
          if (result.price) {
            priceDisplay = `<span class="text-primary font-semibold">$${result.price}</span>`;
          } else if (result.price_min) {
            priceDisplay = `<span class="text-primary font-semibold">$${result.price_min}</span>`;
          }

          // Fix image handling - prioritize image field from API
          let imageDisplay = '';
          if (result.image) {
            imageDisplay = `<img src="${result.image}" alt="${result.title}" class="w-12 h-12 object-cover rounded-lg">`;
          } else if (result.featured_image) {
            imageDisplay = `<img src="${result.featured_image}" alt="${result.title}" class="w-12 h-12 object-cover rounded-lg">`;
          }

          // Determine result type for styling
          const resultType = result.type || 'product';
          const typeLabel = 'Product';

          html += `
            <a href="${productUrl}" class="search-result-item flex items-center gap-4 p-3 rounded-lg hover:bg-gray-800/60 transition-colors duration-200 group">
              <div class="flex-shrink-0">
                ${imageDisplay}
              </div>
              <div class="flex-1 min-w-0">
                <h3 class="text-white font-medium group-hover:text-primary transition-colors duration-200">${title}</h3>
                ${priceDisplay ? `<p class="text-sm text-gray-400 mt-1">${priceDisplay}</p>` : ''}
                <p class="text-xs text-gray-500 mt-1">${typeLabel}</p>
              </div>
              <div class="flex-shrink-0 text-gray-400 group-hover:text-primary transition-colors duration-200">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                  <path fill-rule="evenodd" d="M12.97 3.97a.75.75 0 011.06 0l7.5 7.5a.75.75 0 010 1.06l-7.5 7.5a.75.75 0 11-1.06-1.06l6.22-6.22H3a.75.75 0 010-1.5h16.19l-6.22-6.22a.75.75 0 010-1.06z" clip-rule="evenodd"/>
                </svg>
              </div>
            </a>
          `;
        });

        html += '</div>';

        searchResults.innerHTML = html;
        searchResults.classList.remove('hidden');
        if (searchNoResults) searchNoResults.classList.add('hidden');
      }

      function showNoResults() {
        if (searchNoResults) searchNoResults.classList.remove('hidden');
        if (searchResults) searchResults.classList.add('hidden');
      }

      function highlightQuery(text, query) {
        if (!query) return text;
        const regex = new RegExp(`(${query})`, 'gi');
        return text.replace(regex, '<mark class="bg-primary/20 text-primary px-1 rounded">$1</mark>');
      }
    });
  </script>
</header-drawer>

{% schema %}
{
  "name": "Header",
  "settings": [
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo"
    },
    {
      "type": "text",
      "id": "discord_url",
      "label": "Discord URL",
      "default": "https://discord.gg/bloxmania"
    }
  ]
}
{% endschema %}
